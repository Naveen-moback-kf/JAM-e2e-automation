name: ğŸ§ª Job Mapping E2E Tests

run-name: |
  ${{ 
    github.event_name == 'schedule' && 
    'â° Scheduled Run | smoke_tests.xml | chrome | qa' || 
    (github.event.inputs.execution_mode == 'individual_runner' && 
    format('ğŸƒ {0} | {1} | {2}', github.event.inputs.individual_runner, github.event.inputs.browser, github.event.inputs.environment)) || 
    format('ğŸ“‹ {0} | {1} | {2}', github.event.inputs.test_suite, github.event.inputs.browser, github.event.inputs.environment)
  }}

on:
  # Automatic triggers disabled - Manual execution only
  # Uncomment below to re-enable automatic execution on push/PR
  # push:
  #   branches:
  #     - main
  #     - develop
  #     - 'release/**'
  # 
  # pull_request:
  #   branches:
  #     - main
  #     - develop
  
  # Manual trigger with parameters (ENABLED)
  workflow_dispatch:
    inputs:
      execution_mode:
        description: 'ğŸ¯ Execution Mode'
        required: true
        default: 'test_suite'
        type: choice
        options:
          - test_suite
          - individual_runner
      
      test_suite:
        description: 'ğŸ“‹ Test Suite to Execute (when execution_mode = test_suite)'
        required: false
        default: 'smoke_tests.xml'
        type: choice
        options:
          - smoke_tests.xml
          - regression_tests.xml
          - all_tests.xml
      
      individual_runner:
        description: 'ğŸƒ Individual Runner (when execution_mode = individual_runner)'
        required: false
        default: 'Runner01_KFoneLogin'
        type: choice
        options:
          - Runner01_KFoneLogin
          - Runner02_ValidateAddMoreJobsFunctionality
          - Runner03_ValidateJobmappingHeaderSection
          - Runner04_VerifyJobMappingPageComponents
          - Runner05_ValidateJobProfileDetailsPopup
          - Runner06_PublishJobProfile
          - Runner07_PublishJobFromComparisonScreen
          - Runner08_PublishJobFromDetailsPopup
          - Runner09_PublishSelectedProfiles
          - Runner10_ValidateScreen1SearchResults
          - Runner11a_ValidateGradeFilters
          - Runner11b_ValidateDepartmentFilters
          - Runner11c_ValidateFunctionSubfunctionFilters
          - Runner11d_ValidateMappingStatusAndMultipleFilters
          - Runner12a_ValidateBasicFilterPersistence
          - Runner12b_ValidateAdvancedFilterPersistence
          - Runner13_AddandVerifyCustomSPinJobComparsionPage
          - Runner14_ValidateProfileLevelFunctionality
          - Runner15_ValidateRecommendedProfileDetails
          - Runner16_ValidatePCRestrictedTipMessage
          - Runner17_ValidateSortingFunctionality
          - Runner18a_ValidateBasicSortingPersistence
          - Runner18b_ValidateAdvancedSortingPersistence
          - Runner19_VerifyJobsWithNoBICMappings
          - Runner20_ManualMappingofSPinAutoAI
          - Runner21_MapDifferentSPtoProfileInAutoAI
          - Runner22_ValidateHCMSyncProfilesTab_PM
          - Runner23_VerifyProfileswithNoJobCode_PM
          - Runner24_ValidatePublishCenter_PM
          - Runner25_ValidateExportStatusFunctionality_PM
          - Runner26_VerifyJobsMissingDataTipMessage
          - Runner27_VerifyInfoMessageForMissingDataProfiles
          - Runner28_VerifyInfoMessageForManualMappingProfiles
          - Runner29_ValidateJobsWithMissingGRADEdataInJobMapping
          - Runner30_ValidateJobsWithMissingDEPARTMENTdataInJobMapping
          - Runner31_ValidateJobsWithMissingFUNCTIONdataInJobMapping
          - Runner32_ValidateJobsWithMissingSUBFUNCTIONdataInJobMapping
          - Runner33_ValidateSelectAndHCMSyncLoadedProfiles_PM
          - Runner34_ValidateSelectAndSyncAllProfiles_PM
          - Runner35_ValidateSelectAllWithSearchFunctionality_PM
          - Runner35a_ValidateLoadedProfilesSelectionWithSearch_PM
          - Runner36_ValidateSelectAllWithFiltersFunctionality_PM
          - Runner36a_ValidateLoadedProfilesSelectionWithFilters_PM
          - Runner37_ValidateSelectAndPublishLoadedProfiles_JAM
          - Runner38_ValidateSelectAllWithSearchFunctionality_JAM
          - Runner38a_ValidateLoadedProfilesSelectionWithSearch_JAM
          - Runner39_ValidateSelectAllWithFiltersFunctionality_JAM
          - Runner39a_ValidateLoadedProfilesSelectionWithFilters_JAM
          - Runner40_ValidateSelectAndPublishAllJobProfiles_JAM
          - Runner41_ValidateApplicationPerformance_JAM_and_HCM
          - Runner42_ClearProfileSelectionwithHeaderCheckbox_PM
          - Runner43_ClearProfileSelectionwithNoneButton_PM
          - Runner44_ClearProfileSelectionwithHeaderCheckbox_JAM
          - Runner45_ClearProfileSelectionwithNoneButton_JAM
          - Runner46_ValidateSelectionOfUnmappedJobs_JAM
      
      browser:
        description: 'Browser'
        required: true
        default: 'chrome'
        type: choice
        options:
          - chrome
          - firefox
          - edge
      
      environment:
        description: 'Test Environment'
        required: true
        default: 'qa'
        type: choice
        options:
          - dev
          - qa
          - stage
          - prodeu
          - produs
      
      headless_mode:
        description: 'Run in Headless Mode'
        required: true
        default: true
        type: boolean
      
      parallel_execution:
        description: 'Enable Parallel Execution'
        required: false
        default: false
        type: boolean
      
      login_type:
        description: 'Login Type'
        required: true
        default: 'NON_SSO'
        type: choice
        options:
          - SSO
          - NON_SSO
      
      pams_id:
        description: 'Target PAMS ID (leave empty to verify all clients)'
        required: false
        default: '23139'
        type: string
      
      # Note: Username and password inputs removed due to GitHub's 10-input limit
      # All credentials are now sourced from GitHub Secrets (more secure)
      # Configure in: Settings > Secrets and variables > Actions
      # Required secrets: SSO_USERNAME, SSO_PASSWORD, NON_SSO_USERNAME, NON_SSO_PASSWORD
  
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“… SCHEDULED RUNS - CURRENTLY DISABLED (Manual execution only)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Status: âŒ All schedules DISABLED for manual testing phase
  # To enable: Uncomment the "schedule:" line and any cron schedule below
  # Note: All times are in UTC. Convert your local time to UTC.
  # Cron format: minute hour day_of_month month day_of_week
  # Example: '0 2 * * *' = 2:00 AM UTC every day
  # Use https://crontab.guru/ to build custom schedules
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  # schedule:
    # â”€â”€ Daily Schedules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Daily at 2:00 AM UTC (runs smoke tests by default)
    # - cron: '0 2 * * *'
    
    # Daily at 6:00 AM UTC (morning run)
    # - cron: '0 6 * * *'
    
    # Daily at 2:00 PM UTC (afternoon run)
    # - cron: '0 14 * * *'
    
    # Daily at 10:00 PM UTC (evening run)
    # - cron: '0 22 * * *'
    
    # â”€â”€ Multiple Times Per Day â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Twice daily: 6:00 AM and 6:00 PM UTC
    # - cron: '0 6,18 * * *'
    
    # Three times daily: 6:00 AM, 2:00 PM, 10:00 PM UTC
    # - cron: '0 6,14,22 * * *'
    
    # Every 6 hours
    # - cron: '0 */6 * * *'
    
    # Every 12 hours
    # - cron: '0 */12 * * *'
    
    # â”€â”€ Weekly Schedules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Every Monday at 9:00 AM UTC
    # - cron: '0 9 * * 1'
    
    # Every Friday at 5:00 PM UTC (weekly regression)
    # - cron: '0 17 * * 5'
    
    # Weekdays only (Mon-Fri) at 7:00 AM UTC
    # - cron: '0 7 * * 1-5'
    
    # Weekends only (Sat-Sun) at 10:00 AM UTC
    # - cron: '0 10 * * 6,0'
    
    # â”€â”€ Business Hours â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Every weekday at 8:00 AM UTC (business hours start)
    # - cron: '0 8 * * 1-5'
    
    # Every weekday at 6:00 PM UTC (business hours end)
    # - cron: '0 18 * * 1-5'
    
    # â”€â”€ Custom Intervals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Every 4 hours during business days
    # - cron: '0 */4 * * 1-5'
    
    # First day of every month at midnight UTC
    # - cron: '0 0 1 * *'
    
    # Every Sunday at midnight (weekly full regression)
    # - cron: '0 0 * * 0'

env:
  JAVA_VERSION: '17'
  MAVEN_VERSION: '3.9.5'
  
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“… SCHEDULED RUN CONFIGURATION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Configure what runs automatically when triggered by schedule
  # These defaults are used ONLY for scheduled runs (cron triggers)
  # Manual runs via workflow_dispatch use the UI input selections
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCHEDULED_TEST_SUITE: 'smoke_tests.xml'           # Options: smoke_tests.xml, regression_tests.xml, all_tests.xml
  SCHEDULED_BROWSER: 'chrome'                        # Options: chrome, firefox, edge
  SCHEDULED_ENVIRONMENT: 'qa'                        # Options: dev, qa, stage, prodeu, produs
  SCHEDULED_HEADLESS: 'true'                         # Options: true, false
  SCHEDULED_LOGIN_TYPE: 'NON_SSO'                    # Options: SSO, NON_SSO
  SCHEDULED_PAMS_ID: '23139'                         # Target PAMS ID for scheduled runs

jobs:
  e2e-tests:
    name: ğŸ§ª E2E Tests - ${{ github.event_name == 'schedule' && 'â° Scheduled Run' || github.event.inputs.execution_mode == 'individual_runner' && github.event.inputs.individual_runner || github.event.inputs.test_suite || 'smoke_tests.xml' }} (${{ github.event.inputs.browser || 'chrome' }})
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        # For parallel browser testing
        browser: [chrome]  # Add firefox, edge for multi-browser testing
      fail-fast: false
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: â˜• Setup Java ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'
      
      - name: ğŸ”§ Setup Maven
        uses: stCarolas/setup-maven@v4.5
        with:
          maven-version: ${{ env.MAVEN_VERSION }}
      
      - name: ğŸŒ Setup Chrome Browser
        if: ${{ github.event.inputs.browser == 'chrome' || matrix.browser == 'chrome' }}
        uses: browser-actions/setup-chrome@latest
        with:
          chrome-version: stable
      
      - name: ğŸ¦Š Setup Firefox Browser
        if: ${{ github.event.inputs.browser == 'firefox' || matrix.browser == 'firefox' }}
        uses: browser-actions/setup-firefox@latest
        with:
          firefox-version: latest
      
      - name: ğŸ“¦ Cache Maven Dependencies
        uses: actions/cache@v3
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            ${{ runner.os }}-maven-
      
      - name: ğŸ§¹ Clean Previous Build
        working-directory: e2e-automation
        run: mvn clean
      
      - name: ğŸ“ Create Report Directories
        run: |
          mkdir -p e2e-automation/test-output/ExtentReports
          mkdir -p e2e-automation/test-output/screenshots
          mkdir -p e2e-automation/ExcelReports
          mkdir -p e2e-automation/logs
          mkdir -p e2e-automation/JobCatalogBackups
      
      - name: ğŸ“¥ Download Previous Excel Report (if exists)
        continue-on-error: true
        uses: dawidd6/action-download-artifact@v3
        with:
          workflow: jobmapping_e2e_tests.yml
          name: excel-reports-${{ matrix.browser }}
          path: e2e-automation/ExcelReports/
          if_no_artifact_found: ignore
          search_artifacts: true
          workflow_conclusion: ""
      
      - name: âœ… Check for Existing Excel Report
        run: |
          if [ -f "e2e-automation/ExcelReports/JobMappingAutomationTestResults.xlsx" ]; then
            echo "âœ… Found existing Excel report - will append new results to it"
            ls -lh e2e-automation/ExcelReports/JobMappingAutomationTestResults.xlsx
          else
            echo "â„¹ï¸  No existing Excel report found - will create new one"
          fi
      
      - name: âš™ï¸ Configure Test Environment
        working-directory: e2e-automation
        run: |
          echo "ğŸ”§ Creating config.properties from template..."
          
          # Copy template to config.properties
          cp src/test/resources/config.properties.template src/test/resources/config.properties
          
          # Configure from workflow inputs
          HEADLESS="${{ github.event.inputs.headless_mode || 'true' }}"
          BROWSER="${{ github.event.inputs.browser || 'chrome' }}"
          ENVIRONMENT="${{ github.event.inputs.environment || 'Dev' }}"
          LOGIN_TYPE="${{ github.event.inputs.login_type || 'NON_SSO' }}"
          PAMS_ID="${{ github.event.inputs.pams_id || '23139' }}"
          
          # Update basic settings
          sed -i "s/^headless\.mode=.*/headless.mode=${HEADLESS}/" src/test/resources/config.properties
          sed -i "s/^browser=.*/browser=${BROWSER}/" src/test/resources/config.properties
          sed -i "s/^Environment=.*/Environment=${ENVIRONMENT}/" src/test/resources/config.properties
          sed -i "s/^login\.type=.*/login.type=${LOGIN_TYPE}/" src/test/resources/config.properties
          sed -i "s/^target\.pams\.id=.*/target.pams.id=${PAMS_ID}/" src/test/resources/config.properties
          
          # Inject credentials from GitHub Secrets (SECURE)
          echo "ğŸ” Injecting credentials from GitHub Secrets..."
          sed -i "s/\${SSO_USERNAME}/${{ secrets.SSO_USERNAME }}/" src/test/resources/config.properties
          sed -i "s/\${SSO_PASSWORD}/${{ secrets.SSO_PASSWORD }}/" src/test/resources/config.properties
          sed -i "s/\${NON_SSO_USERNAME}/${{ secrets.NON_SSO_USERNAME }}/" src/test/resources/config.properties
          sed -i "s/\${NON_SSO_PASSWORD}/${{ secrets.NON_SSO_PASSWORD }}/" src/test/resources/config.properties
          
          echo "âœ… config.properties created and configured"
          echo "ğŸ“‹ Configuration Summary:"
          echo "   Browser: ${BROWSER}"
          echo "   Environment: ${ENVIRONMENT}"
          echo "   Headless: ${HEADLESS}"
          echo "   Login Type: ${LOGIN_TYPE}"
          echo "   PAMS ID: ${PAMS_ID}"
          echo "   Credentials: GitHub Secrets"
      
      - name: ğŸ–¥ï¸ Setup Display for Headless (Linux)
        if: runner.os == 'Linux'
        run: |
          echo "ğŸ–¥ï¸  Setting up virtual display for headless execution..."
          sudo apt-get update -qq
          sudo apt-get install -y xvfb libxi6 libgbm1
          sudo Xvfb :99 -ac -screen 0 1920x1080x24 > /dev/null 2>&1 &
          echo "DISPLAY=:99" >> $GITHUB_ENV
          echo "âœ… Virtual display configured (Xvfb on :99)"
      
      - name: ğŸš€ Execute E2E Tests
        working-directory: e2e-automation
        run: |
          # Record start time
          START_TIME=$(date +%s)
          # Detect if this is a scheduled run or manual run
          if [ "${{ github.event_name }}" = "schedule" ]; then
            echo "â° SCHEDULED RUN DETECTED - Using scheduled configuration"
            EXECUTION_MODE="test_suite"
            TEST_SUITE="${{ env.SCHEDULED_TEST_SUITE }}"
            INDIVIDUAL_RUNNER=""
            BROWSER="${{ env.SCHEDULED_BROWSER }}"
            ENVIRONMENT="${{ env.SCHEDULED_ENVIRONMENT }}"
            HEADLESS="${{ env.SCHEDULED_HEADLESS }}"
            PARALLEL="false"
            LOGIN_TYPE="${{ env.SCHEDULED_LOGIN_TYPE }}"
            PAMS_ID="${{ env.SCHEDULED_PAMS_ID }}"
          else
            echo "ğŸ‘¤ MANUAL RUN DETECTED - Using workflow inputs"
            EXECUTION_MODE="${{ github.event.inputs.execution_mode || 'test_suite' }}"
            TEST_SUITE="${{ github.event.inputs.test_suite || 'smoke_tests.xml' }}"
            INDIVIDUAL_RUNNER="${{ github.event.inputs.individual_runner || '' }}"
            BROWSER="${{ github.event.inputs.browser || 'chrome' }}"
            ENVIRONMENT="${{ github.event.inputs.environment || 'qa' }}"
            HEADLESS="${{ github.event.inputs.headless_mode || 'true' }}"
            PARALLEL="${{ github.event.inputs.parallel_execution || 'false' }}"
            LOGIN_TYPE="${{ github.event.inputs.login_type || 'NON_SSO' }}"
            PAMS_ID="${{ github.event.inputs.pams_id || '23139' }}"
          fi
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "    E2E TEST EXECUTION CONFIGURATION"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Execution Mode: ${EXECUTION_MODE}"
          
          if [ "${EXECUTION_MODE}" = "individual_runner" ]; then
            echo "ğŸƒ Individual Runner: ${INDIVIDUAL_RUNNER}"
          else
            echo "ğŸ“‹ Test Suite: ${TEST_SUITE}"
          fi
          
          echo "Browser: ${BROWSER}"
          echo "Environment: ${ENVIRONMENT}"
          echo "Login Type: ${LOGIN_TYPE}"
          echo "PAMS ID: ${PAMS_ID}"
          echo "Credentials: GitHub Secrets"
          echo "Headless Mode: ${HEADLESS}"
          echo "Parallel Execution: ${PARALLEL}"
          echo "Working Directory: $(pwd)"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          # Build Maven command based on execution mode
          if [ "${EXECUTION_MODE}" = "individual_runner" ]; then
            # Run individual test runner
            RUNNER_CLASS="testrunners.functional.JobMapping.${INDIVIDUAL_RUNNER}"
            echo "ğŸƒ Running individual test runner: ${RUNNER_CLASS}"
            # Force TestNG to generate XML results for Excel reporting
            # Set TestNG output directory and ensure XML reports are generated
            MVN_CMD="mvn test -Dtest=${RUNNER_CLASS} -Dtestng.outputdir=test-output"
          else
            # Run test suite XML
            # Verify test suite file exists
            if [ ! -f "${TEST_SUITE}" ]; then
              echo "âŒ ERROR: Test suite file not found: ${TEST_SUITE}"
              echo "ğŸ“‚ Available suite files:"
              ls -la *.xml || echo "No XML files found in current directory"
              exit 1
            fi
            echo "âœ… Test suite file found: ${TEST_SUITE}"
            MVN_CMD="mvn test -DsuiteXmlFile=${TEST_SUITE}"
          fi
          
          # Add browser parameter (if needed by your framework)
          # MVN_CMD="${MVN_CMD} -Dbrowser=${BROWSER}"
          
          # Add environment parameter (if needed by your framework)
          # MVN_CMD="${MVN_CMD} -Denvironment=${ENVIRONMENT}"
          
          # Add parallel execution if enabled (only for test suite mode)
          if [ "${PARALLEL}" = "true" ] && [ "${EXECUTION_MODE}" = "test_suite" ]; then
            MVN_CMD="${MVN_CMD} -Dparallel=methods -DthreadCount=3"
            echo "âš¡ Parallel execution enabled (3 threads)"
          fi
          
          # Add CI/CD specific Maven options
          MVN_CMD="${MVN_CMD} -Dmaven.test.failure.ignore=true -B"
          
          echo ""
          echo "ğŸš€ Executing Maven command:"
          echo "${MVN_CMD}"
          echo ""
          
          # Execute tests (continue on failure to generate reports)
          ${MVN_CMD} || {
            echo "âš ï¸  Tests completed with failures (this is expected, reports will be generated)"
            EXIT_CODE=$?
          }
          
          echo ""
          echo "âœ… Test execution completed"
          echo ""
          
          # Calculate and display execution time
          END_TIME=$(date +%s)
          DURATION=$((END_TIME - START_TIME))
          MINUTES=$((DURATION / 60))
          SECONDS=$((DURATION % 60))
          echo "â±ï¸  Total Execution Time: ${MINUTES}m ${SECONDS}s"
          echo ""
          
          # Display detailed test output summary
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“Š Test Output Summary"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          # Check TestNG results
          if [ -f "test-output/testng-results.xml" ]; then
            echo "âœ… TestNG results file: test-output/testng-results.xml ($(wc -l < test-output/testng-results.xml) lines)"
          else
            echo "âŒ TestNG results file NOT FOUND: test-output/testng-results.xml"
          fi
          
          # List everything in test-output
          if [ -d "test-output" ]; then
            echo ""
            echo "ğŸ“‚ Contents of test-output/:"
            ls -lah test-output/ || echo "Cannot list test-output/"
          else
            echo "âŒ test-output/ directory does NOT exist"
          fi
          
          # Check Surefire reports
          if [ -d "target/surefire-reports" ]; then
            echo ""
            echo "ğŸ“‚ Contents of target/surefire-reports/:"
            ls -lah target/surefire-reports/ | head -20
          fi
          
          # Check ExtentReports
          if [ -d "test-output/ExtentReports" ]; then
            echo ""
            echo "âœ… ExtentReports directory exists"
            ls -la test-output/ExtentReports/ || echo "ExtentReports directory is empty"
          else
            echo "âš ï¸  ExtentReports directory not found"
          fi
          
          # Check ExcelReports
          if [ -d "ExcelReports" ]; then
            echo ""
            echo "âœ… ExcelReports directory exists"
            ls -la ExcelReports/ || echo "ExcelReports directory is empty"
          else
            echo "âš ï¸  ExcelReports directory not found"
          fi
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ“Š Generate Test Report Summary
        if: always()
        run: |
          echo "## ğŸ§ª Test Execution Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Show trigger type
          if [ "${{ github.event_name }}" = "schedule" ]; then
            echo "**Trigger:** â° Scheduled Run (Automatic)" >> $GITHUB_STEP_SUMMARY
            echo "**Test Suite:** ${{ env.SCHEDULED_TEST_SUITE }}" >> $GITHUB_STEP_SUMMARY
            echo "**Browser:** ${{ env.SCHEDULED_BROWSER }}" >> $GITHUB_STEP_SUMMARY
            echo "**Environment:** ${{ env.SCHEDULED_ENVIRONMENT }}" >> $GITHUB_STEP_SUMMARY
            echo "**Headless Mode:** ${{ env.SCHEDULED_HEADLESS }}" >> $GITHUB_STEP_SUMMARY
            echo "**Login Type:** ${{ env.SCHEDULED_LOGIN_TYPE }}" >> $GITHUB_STEP_SUMMARY
            echo "**PAMS ID:** ${{ env.SCHEDULED_PAMS_ID }}" >> $GITHUB_STEP_SUMMARY
          else
            echo "**Trigger:** ğŸ‘¤ Manual Run" >> $GITHUB_STEP_SUMMARY
            EXECUTION_MODE="${{ github.event.inputs.execution_mode || 'test_suite' }}"
            echo "**Execution Mode:** ${EXECUTION_MODE}" >> $GITHUB_STEP_SUMMARY
            
            if [ "${EXECUTION_MODE}" = "individual_runner" ]; then
              echo "**Runner:** ${{ github.event.inputs.individual_runner }}" >> $GITHUB_STEP_SUMMARY
            else
              echo "**Test Suite:** ${{ github.event.inputs.test_suite || 'smoke_tests.xml' }}" >> $GITHUB_STEP_SUMMARY
            fi
            
            echo "**Browser:** ${{ github.event.inputs.browser || 'chrome' }}" >> $GITHUB_STEP_SUMMARY
            echo "**Environment:** ${{ github.event.inputs.environment || 'qa' }}" >> $GITHUB_STEP_SUMMARY
            echo "**Headless Mode:** ${{ github.event.inputs.headless_mode || 'true' }}" >> $GITHUB_STEP_SUMMARY
            echo "**Parallel Execution:** ${{ github.event.inputs.parallel_execution || 'false' }}" >> $GITHUB_STEP_SUMMARY
            echo "**Login Type:** ${{ github.event.inputs.login_type || 'NON_SSO' }}" >> $GITHUB_STEP_SUMMARY
            echo "**PAMS ID:** ${{ github.event.inputs.pams_id || '23139' }}" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Parse TestNG results and display test statistics
          if [ -f "e2e-automation/test-output/testng-results.xml" ]; then
            echo "## ğŸ“ˆ Test Results" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            
            # Extract test counts from TestNG XML
            TOTAL=$(grep -oP '(?<=<testng-results.*total=")[^"]*' e2e-automation/test-output/testng-results.xml || echo "0")
            PASSED=$(grep -oP '(?<=passed=")[^"]*' e2e-automation/test-output/testng-results.xml || echo "0")
            FAILED=$(grep -oP '(?<=failed=")[^"]*' e2e-automation/test-output/testng-results.xml || echo "0")
            SKIPPED=$(grep -oP '(?<=skipped=")[^"]*' e2e-automation/test-output/testng-results.xml || echo "0")
            
            # Calculate pass rate
            if [ "$TOTAL" -gt 0 ]; then
              PASS_RATE=$(awk "BEGIN {printf \"%.1f\", ($PASSED/$TOTAL)*100}")
            else
              PASS_RATE="0.0"
            fi
            
            # Determine status emoji
            if [ "$FAILED" -eq 0 ] && [ "$PASSED" -gt 0 ]; then
              STATUS_EMOJI="âœ…"
              STATUS_TEXT="All Tests Passed"
            elif [ "$FAILED" -gt 0 ]; then
              STATUS_EMOJI="âŒ"
              STATUS_TEXT="Some Tests Failed"
            else
              STATUS_EMOJI="âš ï¸"
              STATUS_TEXT="No Tests Executed"
            fi
            
            echo "### ${STATUS_EMOJI} ${STATUS_TEXT}" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| Metric | Count | Percentage |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|-------|------------|" >> $GITHUB_STEP_SUMMARY
            echo "| âœ… **Passed** | **${PASSED}** | $(awk "BEGIN {printf \"%.1f%%\", ($PASSED/$TOTAL)*100}" 2>/dev/null || echo "N/A") |" >> $GITHUB_STEP_SUMMARY
            echo "| âŒ **Failed** | **${FAILED}** | $(awk "BEGIN {printf \"%.1f%%\", ($FAILED/$TOTAL)*100}" 2>/dev/null || echo "N/A") |" >> $GITHUB_STEP_SUMMARY
            echo "| â­ï¸ **Skipped** | **${SKIPPED}** | $(awk "BEGIN {printf \"%.1f%%\", ($SKIPPED/$TOTAL)*100}" 2>/dev/null || echo "N/A") |" >> $GITHUB_STEP_SUMMARY
            echo "| ğŸ“Š **Total** | **${TOTAL}** | 100% |" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Pass Rate:** ${PASS_RATE}%" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ **Warning:** TestNG results file not found. Test execution may have failed." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          # Add quick links to artifacts
          echo "## ğŸ“¦ Available Reports & Artifacts" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "After the workflow completes, the following artifacts will be available for download:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“Š **Extent Report** - Detailed HTML test report with screenshots" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“ˆ **Excel Reports** - Comprehensive test results in Excel format" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ§ª **TestNG Results** - Raw TestNG XML and HTML reports" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“ **Logs** - Detailed execution logs for debugging" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ“¸ **Screenshots** - Failure screenshots (if any tests failed)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "> ğŸ’¡ **Tip:** Click on the 'Summary' tab above to download artifacts quickly!" >> $GITHUB_STEP_SUMMARY
      
      - name: ğŸ“¤ Upload Extent Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: extent-report-${{ matrix.browser }}
          path: e2e-automation/test-output/ExtentReports/
          retention-days: 30
          if-no-files-found: ignore
      
      - name: ğŸ“¤ Upload TestNG Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: testng-results-${{ matrix.browser }}
          path: |
            e2e-automation/test-output/testng-results.xml
            e2e-automation/test-output/emailable-report.html
            e2e-automation/target/surefire-reports/testng-results.xml
            e2e-automation/target/surefire-reports/emailable-report.html
          retention-days: 30
          if-no-files-found: ignore
      
      - name: ğŸ” Debug - List Excel Report Files
        if: always()
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ” Searching for Excel Reports..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          echo ""
          echo "ğŸ“‚ Current directory:"
          pwd
          
          echo ""
          echo "ğŸ“‚ Checking e2e-automation/ExcelReports/:"
          if [ -d "e2e-automation/ExcelReports" ]; then
            echo "âœ… Directory exists!"
            ls -laR e2e-automation/ExcelReports/
          else
            echo "âŒ Directory does NOT exist"
          fi
          
          echo ""
          echo "ğŸ“‚ Checking for ExcelReports anywhere in e2e-automation:"
          find e2e-automation -type d -name "ExcelReports" 2>/dev/null || echo "No ExcelReports directories found"
          
          echo ""
          echo "ğŸ“‚ Looking for *.xlsx files in e2e-automation:"
          find e2e-automation -name "*.xlsx" -type f 2>/dev/null || echo "No .xlsx files found"
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ“¤ Upload Excel Reports
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: excel-reports-${{ matrix.browser }}
          path: e2e-automation/ExcelReports/
          retention-days: 30
          if-no-files-found: ignore
      
      - name: ğŸ“¤ Upload Screenshots
        if: failure() || contains(github.event.head_commit.message, 'force-screenshots')
        uses: actions/upload-artifact@v4
        with:
          name: screenshots-${{ matrix.browser }}
          path: e2e-automation/test-output/screenshots/
          retention-days: 7
          if-no-files-found: ignore
      
      - name: ğŸ“¤ Upload Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: logs-${{ matrix.browser }}
          path: e2e-automation/logs/
          retention-days: 7
          if-no-files-found: warn
      
      - name: ğŸ’¬ Comment PR with Results
        if: github.event_name == 'pull_request' && always()
        uses: actions/github-script@v7
        continue-on-error: true
        with:
          script: |
            const fs = require('fs');
            let comment = `## ğŸ§ª E2E Test Results\n\n`;
            comment += `**Status:** ${{ job.status }}\n`;
            comment += `**Browser:** ${{ github.event.inputs.browser || 'chrome' }}\n`;
            comment += `**Test Suite:** ${{ github.event.inputs.test_suite || 'smoke_tests.xml' }}\n\n`;
            comment += `ğŸ“Š [View Full Report](${process.env.GITHUB_SERVER_URL}/${process.env.GITHUB_REPOSITORY}/actions/runs/${process.env.GITHUB_RUN_ID})\n`;
            
            try {
              await github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: comment
              });
            } catch (error) {
              console.log('Could not create PR comment:', error.message);
            }

